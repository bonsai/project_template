<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>枠付き画像ジェネレーター</title>
<style>
#preview {
  max-width: 300px;
  margin-top: 20px;
}
</style>
</head>
<body>

<h2>画像アップロード（枠付き自動合成）</h2>

<input type="file" id="file" accept="image/*">

<div>
  <label><input type="radio" name="shape" value="square" checked> 四角</label>
  <label><input type="radio" name="shape" value="circle"> 丸</label>
</div>

<div id="result">
        <!-- Result will be loaded here -->
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
    $('#file').on('change', function () {
        const file = this.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append("image", file);
        formData.append("shape", $('input[name="shape"]:checked').val());

        // Show loading state
        $('#result').html('<p style="text-align:center;">処理中...</p>');

        $.ajax({
            // Vercel Ruby API Endpoint
            url: "/api/upload",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (html) {
                $('#result').html(html);
            },
            error: function(xhr, status, error) {
                console.error("Error details:", xhr);
                let msg = 'エラーが発生しました。';
                if (xhr.responseText) {
                    msg += '<br><small style="color:#666; font-family:monospace; display:block; margin-top:10px; text-align:left; background:#eee; padding:10px; border-radius:4px;">' + 
                           xhr.responseText.replace(/\n/g, '<br>') + '</small>';
                }
                $('#result').html('<p style="color:red; text-align:center;">' + msg + '</p>');
            }
        });
    });
    
    // Also trigger update when shape changes if file is selected
    $('input[name="shape"]').on('change', function() {
        if ($('#file')[0].files.length > 0) {
            $('#file').trigger('change');
        }
    });
    </script>

</body>
</html>
